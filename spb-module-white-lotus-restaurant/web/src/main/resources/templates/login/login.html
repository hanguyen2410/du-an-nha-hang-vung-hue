<!DOCTYPE html>
<html lang="vi">

<head>
    <title>Đăng nhập quản trị | Website quản trị </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/assets/css/main.css">

    <link rel="stylesheet" href="/assets/css/main2.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!--  Login Page-->

    <link rel="stylesheet" href="/assets/login/animate.css">

    <link rel="stylesheet" href="/assets/login/bootstrap.min.css">

    <link rel="stylesheet" href="/assets/login/hamburgers.min.css">

    <link rel="stylesheet" href="/assets/login/select2.min.css">

    <link rel="stylesheet" href="/assets/login/util.css">

    <link rel="stylesheet" href="/assets/login/main.css">

    <link rel="stylesheet" href="/assets/iziToast/toastr.min.css">
</head>

<body>
    <div class="limiter">
        <div class="container-login100">
            <div class="wrap-login100">
                <div class="login100-pic js-tilt d-flex align-items-sm-start my-5" data-tilt>
                    <img src="/assets/images/pink-lotus-icon3.png" alt="IMG">
                </div>
                <!--=====TIÊU ĐỀ======-->
                <div class="login100-form validate-form">
                    <span class="login100-form-title">
                        <b>ĐĂNG NHẬP HỆ THỐNG WHITE LOTUS</b>
                    </span>

                    <!--=====FORM INPUT TÀI KHOẢN VÀ PASSWORD======-->
                    <form id="formLogin" >
<!--                        <div class="frm-alert-danger hide"></div>-->
                        <div class="wrap-input100 validate-input">
                            <input class="input100" type="text" placeholder="Tài khoản quản trị" name="usernameLog"
                                id="usernameLog">
                            <span class="focus-input100"></span>
                            <span class="symbol-input100">
                                <i class='bx bx-user'></i>
                            </span>
                        </div>
                        <div class="wrap-input100 validate-input">
                            <input autocomplete="off" class="input100" type="password" placeholder="Mật khẩu"
                                name="passwordLog" id="passwordLog">
                            <span toggle="#password-field" class="bx fa-fw bx-hide field-icon click-eye"></span>
                            <span class="focus-input100"></span>
                            <span class="symbol-input100">
                                <i class='bx bx-key'></i>
                            </span>
                        </div>

                        <!--=====ĐĂNG NHẬP======-->
                        <div class="container-login100-form-btn">
                            <input type="button" value="Đăng nhập" id="btnLogin"/>
                        </div>
                        <!--=====LINK TÌM MẬT KHẨU======-->
                        <div class="text-right p-t-12">
                            <a class="txt2" href="/forgot">
                                Bạn quên mật khẩu?
                            </a>
                        </div>
                    </form>
                    <!--=====FOOTER======-->
                    <div class="text-center p-t-70 txt2">

                        Phần mềm quản lý nhà hàng <i class="far fa-copyright" aria-hidden="true"></i>
                        <script type="text/javascript">document.write(new Date().getFullYear());</script> <a
                            class="txt2" href=""> Code bởi PHPT </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Javascript-->
    <script src="/assets/jquery/jquery-3.6.0.min.js"></script>

    <script src="/assets/jquery/jquery.validate.min.js"></script>

    <script src="/assets/bootstrap/popper.min.js"></script>

    <script src="/assets/bootstrap/bootstrap.min.js"></script>

    <script src="/assets/bootstrap/bootstrap.bundle.min.js"></script>

    <script src="/assets/sweeralert2/sweetalert2.all.min.js"></script>

    <script src="/assets/iziToast/toastr.min.js"></script>

    <script src="/assets/js/AppBase.js"></script>

    <!--  LoginPage-->

    <script src="/assets/login/easy-number-separator.js"></script>

    <script src="/assets/login/select2.min.js"></script>

    <script>
        function toastError(tittle) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "1000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
            toastr["error"](tittle)
        }

        function toastSuccess(tittle) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "1000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
            toastr["success"](tittle)
        }

    </script>


    <script>

        const page = {
            urls: {
                authLogin: AppBase.API_AUTH + '/login',
                getAllRoles: AppBase.ROLE_API,
            },
            elements: {},
            loadData: {},
            commands: {},
            dialogs: {
                elements: {},
                loadData: {},
                commands: {},
                alertDanger: {}
            },
            initializeEventControl: {}
        }

        page.elements.formLogin = $("#formLogin")
        page.elements.usernameLog = $('#usernameLog');
        page.elements.passwordLog = $('#passwordLog');
        page.elements.btnLogin = $('#btnLogin');

        page.dialogs.alertDanger.formLogin = $("#formLogin .frm-alert-danger");

        let user = new User();

        page.commands.login = () => {
            let username = page.elements.usernameLog.val();
            let password = page.elements.passwordLog.val();
            let obj = {
                username,
                password
            }
            $.ajax({
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },
                type: 'POST',
                url: page.urls.authLogin,
                data: JSON.stringify(obj)
            })
                .done((data) => {
                    let role = data.roles[0].authority;
                    console.log(role)
                    toastSuccess("Đăng nhập thành công.");
                    if (role === "ADMIN" || role === "MANAGER") {
                        setTimeout(function () {
                            window.location.href = "/report";
                        }, 1000);
                    }else {
                        if (role ==="CASHIER" || role ==="STAFF" || role ==="ACCOUNTANT"){
                            setTimeout(function () {
                                window.location.href = "/daily";
                            }, 1000);
                        }
                    }
                    // setTimeout(function () {
                    //             window.location.href = "/";
                    //         }, 1000);
                    //

                })
                .fail((jqXHR) => {
                    toastError("Đăng nhập thất bại, vui lòng xem lại tài khoản hoặc mật khẩu!!!");
                })
        }

        page.elements.formLogin.validate({
            rules: {
                usernameLog: {
                    required: true,
                    maxlength: 50
                },
                passwordLog: {
                    required: true,
                    maxlength: 30
                },

            },
            messages: {
                usernameLog: {
                    required: "Tên đăng nhập là bắt buộc",
                    maxlength: "Họ tên có độ dài tối đa là 50 ký tự"
                },
                passwordLog: {
                    required: "Mật khẩu là bắt buộc",
                    maxlength: "Mật khẩu có độ dài tối đa 30 ký tự"
                },
            },
            showErrors: function () {
                if (this.numberOfInvalids() > 0) {
                    $('.symbol-input100 i.bx').attr('style', 'margin-bottom: 25px !important')
                }
                else {
                    $('.symbol-input100 i.bx').removeAttr('style', 'margin-bottom: 25px !important')
                }
                this.defaultShowErrors();
            },
            submitHandler: function () {
                page.commands.login();
            }
        })

        document.onkeydown=function(evt){
            var keyCode = evt ? (evt.which ? evt.which : evt.keyCode) : event.keyCode;
            if(keyCode == 13)
            {
                page.commands.login();
            }
        }

        page.commands.loadData = () => {
            page.elements.btnLogin.on("click", () => {
                page.elements.formLogin.trigger("submit");
            })
        }

        $(() => {
            page.commands.loadData();
        })
    </script>

</body>

</html>