<!DOCTYPE html>
<html lang="en">

<head>
    <title>White Lotus | Tables</title>
    <th:block th:replace="layout/head"/>

</head>
<body>

<!------------- LOADING SPINNER---------->
<th:block th:replace="layout/loading"/>
<!------------- LOADING SPINNER---------->


<!-- SIDEBAR -->
<th:block th:replace="staff-template/sidebar"/>
<!-- SIDEBAR -->

<!-- CONTENT -->
<section id="content">
    <!-- NAVBAR -->
    <th:block th:replace="layout/navbar"/>
    <!-- NAVBAR -->

    <!-- MAIN -->
    <main>
        <!------  Main header ----->
        <div class="app-title">
            <div class="app-title-child">
                <h3>Danh sách bàn</h3>
            </div>
            <div id="clock"></div>
        </div>
        <!---- End Main header --->
        <div class="cards">
            <div class="row">
                <div class="col-md-12">
                    <div class="tile">
                        <div class="tile-body">
                            <div class="row d-flex flex-row justify-content-center" style="width: 100%; padding: 0; margin: 0">
                                <div class="row d-flex flex-row " id="card-div" style="width: 100%; padding: 0; margin: 0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- MAIN -->
</section>
<!-- CONTENT -->


<!---- JAVA SCRIPT ---->
<th:block th:replace="layout/javascript"/>
<script>
    let currentId;
    let currentPage = 1;
    const page = {
        urls: {
            getAllTables: AppBase.API_TABLE,
            getTableById: AppBase.API_TABLE
        },
        elements: {},
        loadData: {},
        commands: {},
        dialogs: {
            elements: {},
            loadData: {},
            commands: {},
        }
    }

    page.elements.loader = $(".bg-loading");

    page.loadData.getAllTables = () => {
        $.ajax({
            type: "GET",
            headers: {
                'accept': 'application/json',
                'content-type': 'application/json'
            },
            url: page.urls.getAllTables
        })
            .done(data => {
                if (data) {
                    let listTable = data;
                    $.each(listTable, (i, item) => {
                        let str = page.commands.renderTableDTO(item);
                        $("#card-div").append(str);
                        page.commands.styleCard(item);
                    })
                }
            })
    }

    page.loadData.findTableById = (id) => {
        return $.ajax({
            type: "GET",
            url: page.urls.getTableById + "/" + id,
        })
            .done((data) => {
            })
            .fail((jqXHR) => {
                let errors = jqXHR.responseJSON;
                if (errors) {
                    let str = "";
                    $.each(errors, (k, v) => {
                        str += `${v}`
                    })
                    toastFail(str);
                }
            })
    }

    page.commands.styleCard = (table) => {
        if (table.statusValue !== 'EMPTY') {
            $("#card_" + table.id).removeClass('card-empty');
            $("#card_" + table.id).addClass('card-not-empty');
        }
    }

    page.commands.renderTableDTO = (table) => {
        return `
                <div id="card_${table.id}" class="col-2 card text-lg-center me-2 card-empty" data-id="${table.id}"
                     style="padding: 0">
                    <div class="card-body">
                        <h3>
                            <i class="fa-solid fa-utensils"></i>
                        </h3>
                        <h5 class="card-title">${table.name}</h5>
                        <p class="card-text">${table.statusValue}</p>
                    </div>
                </div>`
    }

    page.commands.closeLoading = () => {
        $('.lds-ring').addClass("hide");
        page.elements.loader.addClass("hide");
    }
    page.commands.showLoading = () => {
        $('.lds-ring').removeClass("hide");
        page.elements.loader.removeClass("hide");
    }

    page.commands.loadData = () => {
        page.loadData.getAllTables(currentPage);
    }


    $(() => {
        page.commands.loadData();
    })
</script>
</body>
</html>